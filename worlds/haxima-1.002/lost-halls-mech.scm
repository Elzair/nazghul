(kern-mk-map 'm_losthalls_cpassage 21 21 pal_expanded
	(list
		"rr rr rr rr rr rr {{ {2 .. .. .. {4 {{ {{ rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr {{ {2 .. {8 .. .. {1 bb {{ rr rr rr rr rr rr "
		"rr rr rr rr rr {{ {{ {2 {4 {{ {2 .. .. {4 {{ rr rr rr rr rr rr "
		"rr rr rr rr rr {{ {3 .. .. {1 .. .. .. {4 {{ {{ rr rr rr rr rr "
		"rr rr rr rr .. {1 .. .. .. .. .. .. .. .. {1 {1 rr rr rr rr rr "
		"rr {{ {{ {{ {2 .. {8 .. .. .. .. .. {c {{ {2 .. .. rr rr rr rr "
		"{{ {{ {{ {3 .. {c {{ {a .. .. .. {4 {{ {{ {2 .. {4 {{ {{ rr rr "
		"{1 bb {{ {2 .. {{ rr {{ {2 .. .. {4 {{ {3 .. .. .. {5 {{ {{ {2 "
		".. .. {1 .. .. rr rr {{ {2 .. .. .. {1 .. .. .. .. .. {5 {{ {2 "
		".. .. .. .. .. {{ rr {{ {2 .. .. .. {8 .. .. .. .. .. .. {1 .. "
		".. {8 .. .. .. {5 {{ {3 .. .. {8 {c {{ {a .. .. .. .. .. {8 .. "
		"{4 {{ {2 .. {8 .. {1 .. .. {4 {{ {{ rr {{ {2 .. .. .. {4 {{ {2 "
		"{4 {{ {2 {4 {{ .. .. .. .. .. {5 {{ rr {{ {2 .. .. .. bb {{ {2 "
		".. {1 .. {c {{ .. .. bb .. .. {4 {{ rr rr {8 .. .. {c {{ {b .. "
		".. .. {c {{ {{ .. .. .. .. .. .. {5 {{ {{ {{ {2 {4 {{ {{ {{ {2 "
		"rr rr {{ {{ {{ .. .. .. .. .. .. .. .. .. .. .. {4 {{ rr rr rr "
		"rr rr rr rr rr {{ {2 .. bb .. .. .. .. .. {4 {{ rr {1 rr rr rr "
		"rr rr rr rr rr rr .. {8 {8 .. .. .. .. .. {8 {1 rr rr rr rr rr "
		"rr rr rr rr rr rr {c {{ {{ {2 .. .. .. bb {{ rr rr rr rr rr rr "
		"rr rr rr rr rr rr {{ {{ rr .. .. .. {4 {{ rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr bb {1 .. .. .. .. {4 {{ rr rr rr rr rr rr rr "
	)
	)
	
(kern-mk-map 'm_losthalls_cwall 21 21 pal_expanded
	(list
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr bb "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr {{ {a rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr {4 {{ bb {{ {2 rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr {{ {{ {2 {5 {{ {{ {2 {4 {{ {2 {4 {{ {{ rr rr "
		"rr rr rr rr rr bb {5 {{ {2 .. {1 {1 .. {4 {{ {{ .. {1 {1 rr rr "
		"rr rr rr rr .. {4 {{ {a {8 .. .. rr .. .. {4 {{ .. .. rr rr rr "
		"rr rr rr .. .. .. {5 {{ {{ rr rr rr rr rr rr {1 .. .. rr rr rr "
		"rr rr {8 {8 .. rr rr {{ {{ rr rr rr rr rr .. .. .. rr rr rr rr "
		"rr rr {{ {{ {2 rr rr rr rr rr rr rr .. .. bb .. .. rr rr rr rr "
		"rr rr rr {{ {2 .. .. rr rr rr rr rr .. .. {8 {8 .. rr rr rr rr "
		"rr rr rr {{ {2 .. bb .. rr rr rr rr rr {4 {{ {{ .. rr rr rr rr "
		"rr rr rr {1 .. .. .. .. rr rr {{ rr rr .. {5 {{ .. rr rr rr rr "
		"rr rr rr rr .. .. .. rr rr {{ {{ {{ {2 .. .. {1 .. .. rr rr rr "
		"rr rr rr {8 {8 {8 .. .. {8 {9 {1 {1 .. {8 .. rr .. .. rr rr rr "
		"rr rr {4 {{ {{ {{ {2 {4 {{ {{ {2 .. {c {{ rr rr rr .. .. rr rr "
		"rr rr {4 {{ rr rr .. .. {4 {{ {2 bb {{ {{ rr rr rr .. rr rr rr "
		"rr rr rr rr rr rr rr rr .. rr .. {4 {{ rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr .. rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr {C "
	)
	)
	
(kern-mk-map 'm_losthalls_cpassage2 21 21 pal_expanded
	(list
		"rr rr rr rr rr rr rr rr rr {8 .. .. .. rr rr rr rr rr rr rr bb "
		"rr rr rr rr rr rr rr rr rr {{ {2 .. rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr {{ {{ {3 .. .. rr rr .. rr rr rr rr rr rr "
		"rr rr rr rr rr {4 {{ {{ {{ {2 .. .. rr .. .. .. rr rr rr rr rr "
		"rr rr rr rr .. .. {1 {1 {1 .. .. .. .. .. bb .. rr rr rr rr rr "
		"rr rr rr rr .. .. .. .. .. .. .. {8 .. .. .. .. .. .. .. rr rr "
		"rr rr rr {{ {a .. .. .. .. .. {4 {{ {a .. .. .. {8 {8 .. .. rr "
		"rr .. rr {{ {{ .. .. .. .. .. {4 {{ {{ {a .. .. {{ {{ {2 rr rr "
		"rr .. .. {1 {1 .. .. .. bb .. {4 {{ {7 {{ {2 .. {5 {{ {2 rr rr "
		".. .. .. .. .. bb .. .. .. .. .. {1 .. {1 .. .. .. bb .. .. .. "
		".. .. .. .. .. rr .. .. .. .. .. .. {8 {8 .. .. .. .. .. .. .. "
		"rr .. .. rr .. .. .. {8 .. .. .. rr {{ {{ {2 .. .. {8 {8 {8 .. "
		"rr rr rr rr {8 .. {4 {{ {2 .. rr rr {{ {3 .. .. {4 {{ {{ {{ rr "
		"rr rr rr rr {{ {8 .. {1 .. .. {4 {{ {3 .. .. .. {4 {{ {{ rr rr "
		"rr rr rr {{ {{ {{ {a .. .. .. .. {1 .. .. bb .. .. {1 rr rr rr "
		"rr rr rr rr {{ {{ {{ {2 .. .. .. .. .. .. .. .. .. rr rr rr rr "
		"rr rr rr rr rr .. .. .. .. {8 .. .. .. .. .. .. .. rr rr rr rr "
		"rr rr rr rr rr rr rr .. rr {{ {2 .. .. rr .. rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr {{ {2 .. .. rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr .. .. .. rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr .. .. .. .. rr rr rr rr rr rr {C "
	)
	)
	
(kern-mk-map 'm_losthalls_croom 21 21 pal_expanded
	(list
		"rr rr rr rr rr rr rr .. .. .. .. .. .. rr rr rr rr rr rr rr bb "
		"rr rr rr rr rr rr rr .. .. .. .. .. .. rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr xx xx bb w+ xx d, xx w+ xx xx rr rr rr rr rr rr "
		"rr rr rr rr rr rr .. .. .. .. .. .. .. .. rr rr rr rr rr rr rr "
		"rr rr rr rr rr .. .. .. .. .. .. .. .. {4 {{ {{ rr rr rr rr rr "
		"rr rr rr {{ {{ .. .. .. bb .. .. .. .. .. .. .. {{ rr rr rr rr "
		"rr rr xx {5 {{ .. .. .. .. .. .. .. .. .. .. .. {1 .. xx rr rr "
		"rr .. xx .. {1 .. .. bb xx xx w+ xx xx xx .. .. .. .. xx .. .. "
		".. .. w+ .. .. .. .. xx ,, ,, ,, ,, ,, rr .. .. .. .. w+ .. .. "
		".. .. xx .. .. .. .. xx ,, ,, .. ,, ,, xx .. .. .. .. rr .. .. "
		".. .. d, .. .. .. .. w+ ,, ,, ,, ,, ,, w+ .. bb .. .. d, .. .. "
		".. .. rr .. .. .. .. xx ,, ,, .. bb .. xx .. .. .. .. xx .. .. "
		".. .. w+ .. .. .. .. rr .. ,, ,, .. ,, xx .. .. .. .. w+ .. .. "
		".. rr xx .. {8 .. .. rr xx d, xx w+ xx rr .. .. {8 .. xx .. .. "
		"rr rr bb {4 {{ .. .. .. .. .. ,, .. .. .. .. .. {{ {a xx rr rr "
		"rr rr rr rr {1 .. .. .. ,, .. .. .. .. .. .. .. {{ {{ xx rr rr "
		"rr rr rr rr rr {{ {a .. .. .. .. .. .. .. .. .. {{ rr rr rr rr "
		"rr rr rr rr rr {{ {{ {2 .. .. .. .. .. .. .. rr rr rr rr rr rr "
		"rr rr rr rr rr rr xx xx w+ xx d, xx w+ rr xx xx rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr .. .. .. .. .. .. rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr .. .. .. .. .. .. .. rr rr rr rr rr rr {C "
	)
	)
	
(kern-mk-map 'm_losthalls_cruin 21 21 pal_expanded
	(list
		"rr rr rr rr rr rr rr .. bb .. .. .. .. rr rr rr rr rr rr rr bb "
		"rr rr rr rr rr rr rr .. {8 .. .. .. .. rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr xx xx bb {{ xx .. rr w+ xx xx rr rr rr rr rr rr "
		"rr rr rr rr rr rr .. .. {1 .. .. bb .. .. rr rr rr rr rr rr rr "
		"rr rr rr rr rr .. .. .. .. .. .. .. .. {4 {{ {{ rr rr rr rr rr "
		"rr rr rr {{ {{ .. .. .. bb .. .. .. .. .. .. .. {{ rr rr rr rr "
		"rr rr xx {5 {{ .. .. .. .. .. .. .. .. .. bb .. {1 .. xx rr rr "
		"rr .. xx .. {1 .. .. rr xx .. w+ bb .. rr .. .. .. .. xx .. .. "
		".. .. rr bb .. .. .. xx .. ,, ,, .. .. rr .. .. .. .. {8 bb .. "
		".. bb {{ {2 .. .. .. bb ,, .. .. .. ,, xx .. .. .. {4 {{ {2 .. "
		".. .. .. .. .. bb .. w+ .. ,, ,, ,, ,, d, .. bb .. .. d, .. .. "
		".. {4 {{ bb .. .. .. .. ,, .. .. bb .. xx .. ,, .. bb .. .. .. "
		".. bb w+ .. .. .. .. rr .. ,, .. .. ,, .. .. .. .. .. w+ bb .. "
		".. rr xx .. {8 .. .. xx rr .. rr .. xx rr bb .. {8 .. xx .. .. "
		"rr rr bb {4 {{ .. .. .. .. bb .. .. .. .. .. .. {{ {a xx rr rr "
		"rr rr rr rr {1 .. .. .. .. .. .. .. .. .. .. .. {{ {{ xx rr rr "
		"rr rr rr rr rr {{ {a .. .. .. .. .. bb .. .. .. {{ rr rr rr rr "
		"rr rr rr rr rr {{ {{ {2 {8 bb .. .. .. .. .. rr rr rr rr rr rr "
		"rr rr rr rr rr rr xx xx {{ xx .. .. bb rr xx xx rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr {1 .. .. .. .. .. rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr .. .. bb .. .. .. bb rr rr rr rr rr rr {C "
	)
	)
	
(kern-mk-map 'm_losthalls_cblock 21 21 pal_expanded
	(list
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr bb "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr xx xx xx bb xx xx rr xx xx xx rr rr rr rr rr rr "
		"rr rr rr rr rr rr .. .. .. .. .. .. .. .. rr rr rr rr rr rr rr "
		"rr rr rr rr rr .. .. .. .. .. .. .. .. {4 {{ {{ rr rr rr rr rr "
		"rr rr rr {{ {{ xx xx ,, ,, xx xx xx w+ w+ xx xx {{ rr rr rr rr "
		"rr rr xx {5 {{ rr ,, ,, .. ,, xx @@ @@ bb @@ xx {1 .. xx rr rr "
		"rr rr xx .. {1 ws ,, .. ,, ,, xx ,, ,, ,, ,, rr .. .. bb rr rr "
		"rr rr xx bb .. bb ,, ,, ,, ,, ,, ,, ,, .. ,, w+ .. .. xx rr rr "
		"rr rr bb .. .. rr ,, ,, ,, ,, xx ,, ,, ,, ,, rr .. .. xx rr rr "
		"rr rr rr .. .. ws .. .. ,, ,, xx xx bb w+ xx xx .. .. xx rr rr "
		"rr rr xx bb .. xx ,, ,, ,, ,, xx ,, ,, ,, ,, xx .. .. rr rr rr "
		"rr rr xx .. .. ,, ,, bb ,, ,, ,, ,, ,, .. ,, ,, .. .. rr rr rr "
		"rr rr rr .. {8 ,, ,, ,, .. ,, ,, ,, ,, ,, ,, ,, {8 .. xx rr rr "
		"rr rr xx {4 {{ xx ,, .. ,, ,, xx ,, .. ,, ,, xx {{ {a xx rr rr "
		"rr rr rr rr {1 rr rr ,, ,, xx xx xx rr ws xx xx {{ {{ xx rr rr "
		"rr rr rr rr rr {{ {a .. .. .. .. .. .. .. .. {4 {{ rr rr rr rr "
		"rr rr rr rr rr {{ {{ {2 .. .. .. .. .. .. .. rr rr rr rr rr rr "
		"rr rr rr rr rr rr xx xx rr rr xx rr xx xx xx xx rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr {C "
	)
	)

(kern-mk-map 'm_losthalls_special 21 21 pal_expanded
	(list
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr .. .. .. .. .. .. .. .. .. .. .. .. {8 .. .. rr rr rr "
		".. .. .. .. rr .. .. .. bb .. .. .. .. .. {4 {{ rr .. .. .. .. "
		"rr rr rr rr rr rr .! {8 {8 .. .! .. .. .! {8 {1 rr rr rr rr rr "
		"rr rr rr rr rr {{ {e {{ {{ {2 .. .. .. bb {{ {2 rr rr rr rr rr "
		"rr rr rr rr rr {5 {{ {{ rr .! .. .! {4 {{ {{ rr rr rr rr rr rr "
		"rr rr rr rr rr .! bb .! .! .! .! .! .! {A {{ rr rr rr rr rr rr "
	)
	)


(kern-mk-map 'm_losthalls_stairu 21 21 pal_expanded
	(list
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr xx xx xx xx xx xx xx xx xx xx xx xx xx rr rr rr rr "
		"rr rr rr xx xx .. .. .. .. .. .. .. .. .. .. .. xx xx rr rr rr "
		"rr rr rr xx .. .. .. .. .. .. .. .. .. .. .. .. .. xx rr rr rr "
		"rr rr rr xx .. .. .. .. ,, .. ,, .. .. .. ,, .. .. xx rr rr rr "
		"rr rr rr xx .. .. .. .. .. .. .. .. ,, .. .. .. .. xx rr rr rr "
		"rr rr rr xx .. .. .. ,, ,, ,, ,, .. .. .. .. .. .. xx rr rr rr "
		"rr rr rr xx .. .. .. ,, .. .. .. ,, ,, ,, ,, .. .. xx rr rr rr "
		"rr rr rr xx .. .. xx ,, ,, ,, ,, ,, ,, ,, xx .. .. xx rr rr rr "
		"rr rr rr xx .. xx xx xx cc cc cc cc cc xx xx xx .. xx rr rr rr "
		"rr rr rr xx .. xx xx xx ,, ,, ,, ,, ,, xx xx xx .. xx rr rr rr "
		"rr rr rr xx .. .. xx xx cc cc cc cc cc xx xx .. .. xx rr rr rr "
		"rr rr rr xx .. .. xx xx xx ,, ,, ,, xx xx xx .. .. xx rr rr rr "
		"rr rr rr xx .. .. .. xx xx cc cc cc xx xx .. .. .. xx rr rr rr "
		"rr rr rr xx xx .. .. xx xx ,, ,, ,, xx xx .. .. xx xx rr rr rr "
		"rr rr rr rr xx xx xx xx xx cc cc cc xx xx xx xx xx rr rr rr rr "
		"rr rr rr rr rr rr rr rr xx ,, ,, ,, xx rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr xx cc cc cc xx rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr xx d, d, d, xx rr rr rr rr rr rr rr rr "
	)
	)
	
(kern-mk-map 'm_losthalls_rhall 21 21 pal_expanded
	(list
		"rr rr rr rr rr rr rr xx .. ,, .. .. .. xx rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr xx .. .. .. ,, .. xx rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr xx .. .. ,, ,, .. rr rr rr rr rr rr rr rr "
		"rr rr rr rr xx xx rr xx bb .. .. .. .. xx xx xx xx rr rr rr rr "
		"rr rr rr xx xx .. .. .. .. .. .. .. .. bb .. .. xx xx rr rr rr "
		"rr rr rr xx .. .. .. .. .. .. .. .. .. .. .. .. .. xx rr rr rr "
		"rr rr rr xx .. @@ @@ @@ @@ .. .. .. @@ @@ @@ @@ .. xx rr rr rr "
		"xx rr xx xx .. .. .. .. .. .. ,, .. .. .. .. .. .. xx rr xx xx "
		".. bb .. .. .. @@ @@ @@ @@ .. .. .. @@ @@ @@ @@ .. .. .. .. .. "
		".. .. .. ,, .. .. ,, .. .. .. .. .. .. .. .. .. .. .. .. ,, .. "
		",, .. ,, ,, .. .. .. .. bb .. .. .. .. .. ,, .. .. .. .. .. .. "
		".. .. .. .. .. .. .. .. .. .. .. ,, .. .. .. bb .. .. ,, .. ,, "
		",, .. .. .. .. @@ @@ @@ @@ .. ,, .. @@ @@ @@ @@ .. .. .. .. .. "
		"xx xx rr xx .. .. .. .. .. .. .. .. .. .. .. .. .. xx xx rr xx "
		"rr rr rr xx .. @@ bb @@ @@ .. .. .. @@ @@ @@ @@ .. xx rr rr rr "
		"rr rr rr rr .. .. .. .. .. .. .. .. .. .. .. .. .. xx rr rr rr "
		"rr rr rr xx xx .. .. .. .. .. .. .. .. .. .. .. xx xx rr rr rr "
		"rr rr rr rr xx xx xx xx .. .. .. .. .. xx xx rr xx rr rr rr rr "
		"rr rr rr rr rr rr rr bb .. .. ,, .. ,, xx rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr xx .. .. ,, bb .. rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr xx .. ,, .. .. .. xx rr rr rr rr rr rr rr "
	)
	)
	
(kern-mk-map 'm_losthalls_rwall 21 21 pal_expanded
	(list
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr xx xx xx rr bb rr xx xx xx xx xx xx xx rr rr rr rr "
		"rr rr rr xx xx .. .. .. .. .. .. .. .. .. .. .. xx xx rr rr rr "
		"rr rr rr xx .. .. .. pp .. .. .. .. bb pp .. .. .. xx rr rr rr "
		"rr rr rr xx .. .. .. .. .. .. .. .. .. .. .. .. .. xx rr rr rr "
		"rr rr rr rr .. pp bb pp .. .. .. .. .. pp .. pp .. rr rr rr rr "
		"rr rr rr xx .. .. .. .. .. .. .. .. .. .. .. .. .. rr rr rr rr "
		"rr rr rr xx .. .. .. .. .. .. .. .. .. .. .. bb .. xx rr rr rr "
		"rr rr rr xx .. .. .. .. bb .. pp .. .. .. .. .. .. xx rr rr rr "
		"rr rr rr xx .. .. .. .. .. .. .. .. .. .. .. .. .. xx rr rr rr "
		"rr rr rr rr .. .. .. .. .. .. .. .. .. .. .. .. .. xx rr rr rr "
		"rr rr rr xx .. pp .. pp .. .. .. .. .. pp .. pp .. bb rr rr rr "
		"rr rr rr xx .. .. bb .. .. .. .. .. .. .. .. bb .. xx rr rr rr "
		"rr rr rr rr .. .. .. pp .. .. .. .. .. pp .. .. .. xx rr rr rr "
		"rr rr rr xx xx .. .. .. .. .. .. .. .. .. .. .. xx xx rr rr rr "
		"rr rr rr rr xx xx xx rr xx xx bb xx rr rr xx xx xx rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
	)
	)
	
(kern-mk-map 'm_losthalls_rrooms 21 21 pal_expanded
	(list
		"rr rr rr rr rr rr rr rr xx .. .. ,, xx rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr xx xx d, xx xx rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr xx .. .. .. xx rr rr rr rr rr rr rr rr "
		"rr rr rr rr xx xx xx xx xx .. ,, .. xx xx xx xx xx rr rr rr rr "
		"rr rr rr xx xx .. .. xx xx .. .. .. xx xx .. .. xx xx rr rr rr "
		"rr rr rr xx .. .. .. .. xx xx d, xx xx ,, .. .. .. xx rr rr rr "
		"rr rr rr xx .. .. ,, .. ws .. .. .. ws ,, ,, .. .. xx rr rr rr "
		"rr rr rr xx xx .. ,, .. xx .. ,, .. xx .. .. ,, xx xx rr rr rr "
		"xx xx xx xx xx xx d, xx xx .. .. .. xx xx d, xx xx xx xx xx xx "
		".. xx .. .. .. xx .. .. .. .. .. .. .. .. .. xx .. .. .. xx ,, "
		".. d, ,, .. .. d, .. ,, .. ,, .. ,, .. .. ,, d, .. ,, .. d, .. "
		",, xx .. .. .. xx .. .. .. .. ,, .. .. .. .. xx .. .. .. xx .. "
		"xx xx xx xx xx xx d, xx xx .. .. .. xx xx d, xx xx xx xx xx xx "
		"rr rr rr xx xx .. ,, .. xx .. .. ,, xx .. .. .. xx xx rr rr rr "
		"rr rr rr xx .. .. ,, ,, ws .. ,, .. ws .. ,, ,, .. xx rr rr rr "
		"rr rr rr xx .. .. .. .. xx xx d, xx xx .. ,, .. .. xx rr rr rr "
		"rr rr rr xx xx .. .. xx xx .. .. .. xx xx .. .. xx xx rr rr rr "
		"rr rr rr rr xx xx xx xx xx ,, .. .. xx xx xx xx xx rr rr rr rr "
		"rr rr rr rr rr rr rr rr xx .. ,, .. xx rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr xx xx d, xx xx rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr xx .. .. .. xx rr rr rr rr rr rr rr rr "
	)
	)

(kern-mk-map 'm_losthalls_rwall 21 21 pal_expanded
	(list
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr xx xx xx rr bb rr xx xx xx xx xx xx xx rr rr rr rr "
		"rr rr rr xx xx .. .. .. .. .. .. .. .. .. .. .. xx xx rr rr rr "
		"rr rr rr xx .. .. .. pp .. .. .. .. bb pp .. .. .. xx rr rr rr "
		"rr rr rr xx .. .. .. .. .. .. .. .. .. .. .. .. .. xx rr rr rr "
		"rr rr rr rr .. pp bb pp .. .. .. .. .. pp .. pp .. rr rr rr rr "
		"rr rr rr xx .. .. .. .. .. .. .. .. .. .. .. .. .. rr rr rr rr "
		"rr rr rr xx .. .. .. .. .. .. .. .. .. .. .. bb .. xx rr rr rr "
		"rr rr rr xx .. .. .. .. bb .. pp .. .. .. .. .. .. xx rr rr rr "
		"rr rr rr xx .. .. .. .. .. .. .. .. .. .. .. .. .. xx rr rr rr "
		"rr rr rr rr .. .. .. .. .. .. .. .. .. .. .. .. .. xx rr rr rr "
		"rr rr rr xx .. pp .. pp .. .. .. .. .. pp .. pp .. bb rr rr rr "
		"rr rr rr xx .. .. bb .. .. .. .. .. .. .. .. bb .. xx rr rr rr "
		"rr rr rr rr .. .. .. pp .. .. .. .. .. pp .. .. .. xx rr rr rr "
		"rr rr rr xx xx .. .. .. .. .. .. .. .. .. .. .. xx xx rr rr rr "
		"rr rr rr rr xx xx xx rr xx xx bb xx rr rr xx xx xx rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr rr "
	)
	)
	
(kern-mk-map 'm_losthalls_rrockfall 21 21 pal_expanded
	(list
		"rr rr rr rr rr rr rr xx rr rr rr rr rr rr rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr xx bb rr rr bb rr xx rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr xx rr bb .. .. bb xx rr rr rr rr rr rr rr "
		"rr rr rr rr xx xx xx xx .. .. ,, bb .. xx xx xx xx rr rr rr rr "
		"rr rr rr xx xx .. .. .. bb .. .. .. .. .. .. .. xx xx rr rr rr "
		"rr rr rr xx .. .. bb {8 .. .. .. bb .. bb .. .. .. xx rr rr rr "
		"rr rr rr xx .. {4 {{ {{ {2 .. .. .. .. .. bb {8 .. xx rr rr rr "
		"rr xx xx xx .. .. {1 bb .. bb .. rr rr .. {4 {{ {2 xx xx xx rr "
		"rr bb .. bb .. bb {4 {{ {2 bb rr rr rr bb .. {1 .. .. bb rr rr "
		"rr rr bb .. .. .. bb {1 rr .. rr bb rr .. .. bb .. .. bb .. rr "
		"rr rr rr .. .. .. bb rr bb bb rr bb .. bb {8 .. .. .. bb rr rr "
		"rr rr bb .. .. .. .. rr rr .. bb rr .. {4 {{ {2 .. bb .. rr rr "
		"rr rr rr .. .. bb .. bb .. rr bb rr .. bb bb bb .. .. .. bb rr "
		"rr xx xx xx .. bb .. .. .. .. .. .. .. bb rr bb .. xx xx xx rr "
		"rr rr rr xx .. .. bb .. .. bb .. .. bb .. bb rr .. xx rr rr rr "
		"rr rr rr xx .. {4 {{ {2 bb .. .. .. .. .. .. .. .. xx rr rr rr "
		"rr rr rr xx xx .. {1 .. bb .. .. .. bb .. bb .. xx xx rr rr rr "
		"rr rr rr rr xx xx xx xx bb .. .. .. bb xx xx xx xx rr rr rr rr "
		"rr rr rr rr rr rr rr xx .. .. bb .. rr xx rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr xx bb rr rr bb rr xx rr rr rr rr rr rr rr "
		"rr rr rr rr rr rr rr xx rr rr rr rr rr xx rr rr rr rr rr rr rr "
	))



;probability for edge terrains... out of 83
(define losthalls-terrain-edges
	(list
		(list 20 'm_losthalls_cwall #f)
		(list 30 'm_losthalls_cblock #f)
		(list 50 'm_losthalls_cpassage #t)
		(list 60 'm_losthalls_cpassage2 #t)
		(list 75 'm_losthalls_cruin #t)
		(list 90 'm_losthalls_croom #t)
		(list 999 'm_test2templ_room #t 'test2-room-n 'test2-room-w 'test2-room-e 'test2-room-s)
	))

;probability for area terrains... out of 149
(define losthalls-terrain-area
	(list
		(list 30 'm_losthalls_cwall)
		(list 40 'm_losthalls_cblock)
		(list 65 'm_losthalls_cpassage)
		(list 95 'm_losthalls_cpassage2)
		(list 115 'm_losthalls_cruin)
		(list 990 'm_losthalls_croom)
	))
	
(define losthalls-passable-edges
	(list
		(list 60 'm_losthalls_cpassage)
		(list 90 'm_losthalls_cpassage2)
		(list 110 'm_losthalls_croom)
		(list 999 'm_test2templ_room 'test2-room-n 'test2-room-w 'test2-room-e 'test2-room-s)
	))
	
;probability for edge terrains... out of 83
(define losthalls-ruin-edges
	(list
		(list 20 'm_losthalls_rwall #f)
		(list 30 'm_losthalls_rrockfall #f)
		(list 50 'm_losthalls_rhall #t)
		(list 60 'm_losthalls_rhall #t)
		(list 75 'm_losthalls_rrooms #t)
		(list 90 'm_losthalls_rhall #t)
		(list 999 'm_test2templ_room #t 'test2-room-n 'test2-room-w 'test2-room-e 'test2-room-s)
	))

;probability for area terrains... out of 149
(define losthalls-ruin-area
	(list
		(list 30 'm_losthalls_rwall)
		(list 40 'm_losthalls_rwall)
		(list 65 'm_losthalls_rrooms)
		(list 95 'm_losthalls_rrockfall)
		(list 115 'm_losthalls_rhall)
		(list 990 'm_losthalls_rhall)
	))

;map areas replaced by the various blitting ops
(define losthalls-room-blitstats
	(prmap-mk-blitstats 21 21 5 4 5))
	
(define losthalls-ruin-blitstats
	(prmap-mk-blitstats 21 21 4 4 4))
	
;parameters to random number generators
(define losthalls-random-type-ew (prmap-mk-prng-params (deep-rno) (deep-rno) (deep-rno) (deep-rno) 83))
(define losthalls-random-type-ns (prmap-mk-prng-params (deep-rno) (deep-rno) (deep-rno) (deep-rno) 83))
(define losthalls-random-type-area (prmap-mk-prng-params (deep-rno) (deep-rno) (deep-rno) (deep-rno) 149))


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; critters

;; critter types, list of lists of (value, critter tag)
(define losthalls-monster-types
	(list 
		(list 
			(list 100 'bat)
		)
		(list
			(list 100 'rat)
			(list 200 'bat)
		)
		(list
			(list 100 'giant-spider)
			(list 150 'queen-spider)
		)
		(list
			(list 100 'cave-goblin-slinger)
			(list 200 'cave-goblin-berserker)
			(list 250 'cave-goblin-priest)
		)
		(list
			(list 50 'cave-goblin-slinger-m)
			(list 100 'cave-goblin-berserker-m)
			(list 300 'troll-m)
			(list 350 'troll-geomancer-m)
		)
		(list
			(list 100 'green-slime)
			(list 200 'yellow-slime)
		)	
		(list
			(list 50 'cave-goblin-slinger-m)
			(list 100 'cave-goblin-berserker-m)
			(list 150 'troll-m)
			(list 350 'gint-warrior-m)
			(list 400 'gint-mage-m)
		)
	)
)

;; group types list of lists of
;; (randomnumber offset, type index, total value, number)
(define losthalls-group-types
	(list
		(list 10 0 100 "1d4+3") ;bats
		(list 20 1 100 "1d4+3") ;rats
		(list 30 1 200 "1d6+4") ;bats n rats
		(list 40 5 100 "1d3+2") ;slime
		(list 50 2 100 "1d4+3") ;spiders
		(list 60 3 100 "1d3+1") ;goblins
		(list 70 2 110 "1d4+3") ;spiders 1q
		(list 90 2 150 "1d6+4") ;spiders +qs
		(list 100 5 200 "1d6+3") ;slime+
		(list 110 3 200 "1d6+4") ;goblin war
		(list 140 4 300 "1d6+3") ;trolls
		(list 160 6 350 "1d6+3") ;gint
		(list 200 3 210 "1d6+5") ;goblin war +p
		(list 220 3 250 "2d4+4") ;goblin tribe
		(list 230 4 350 "1d6+5") ;trolls +m
		(list 240 6 400 "2d4+4") ;gint + m
	)
)

; creates new objects for a room
;    uses lost halls critter types, and difficulty increases a bit northwards and a lot downwards
(define (losthalls-room-init-contents kplace roomdata)
	(let* (
			(ryloc (prmap-roomdata-y roomdata))
			(rzloc (prmap-roomdata-z roomdata))
			(distance (+ (* rzloc 20) ryloc))
		)
		(if (and (null? (kern-place-get-beings kplace))
				(< (kern-dice-roll "1d100") 
					(min 75 (+ 25 (* 2 distance)))))
			(begin 
			(map (lambda (monster)
				(begin 
					(prmap-room-addmonster kplace monster)))
				(prmap-mk-monster-group losthalls-group-types losthalls-monster-types 
					(string-append "1d" (number->string (min 300 (ceiling (* 25 distance)))))
					(+ 250 (* 25 distance) (kern-dice-roll "1d200"))
					)))
		)
	))

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; Time memory - move to prmap?

(define (losthalls-timekeeper-mkobj time)
  (list 'losthalls time))
(define (losthalls-timekeeper-get tk) (cadr tk))
(define (losthalls-timekeeper-set! tk val) (set-car! (cdr mm) val))

(mk-obj-type 't_losthalls_timekeeper nil nil layer-none nil)

(define (losthalls-timekeeper-mk)
  (bind (kern-obj-set-visible (kern-mk-obj t_losthalls_timekeeper 1) #f)
        (losthalls-timekeeper-mkobj (map - game-start-time
                        (time-mk 0 0 0 1 1 1)))))


(define (losthalls-room-store-time kplace roomdata)
	(let* (
			(ryloc (prmap-roomdata-y roomdata))
			(rzloc (prmap-roomdata-z roomdata))
			(distance (+ (* rzloc 20) ryloc))
		)
		(if (and (null? (kern-place-get-beings kplace))
				(< (kern-dice-roll "1d100") 
					(min 75 (+ 25 (* 2 distance)))))
			(begin 
			(map (lambda (monster)
				(begin 
					(prmap-room-addmonster kplace monster)))
				(prmap-mk-monster-group losthalls-group-types losthalls-monster-types 
					(string-append "1d" (number->string (min 300 (ceiling (* 25 distance)))))
					(+ 250 (* 25 distance) (kern-dice-roll "1d200"))
					)))
		)
	))

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; timer object

;; one hour wait
(define (losthalls-respawn-time? oldtime)
  (let ((curtime (kern-get-time)))
    (or (> (time-year curtime) (time-year oldtime))
        (> (time-month curtime) (time-month oldtime))
        (> (time-week curtime) (time-week oldtime))
        (> (time-day curtime) (time-day oldtime))
        (and (= (time-day curtime) (time-day oldtime))
             (> (time-hour curtime) (time-hour oldtime))))))

(define (losthalls-timer-time timer) (cadr (gob timer)))
(define (losthalls-timer-set! timer val) (set-car! (cdr (gob timer)) val))

(mk-obj-type 't_losthalls_timer nil nil layer-none nil)

(define (losthalls-mk-timer)
  (bind (kern-obj-set-visible (kern-mk-obj t_losthalls_timer 1) #f)
        (list 'timer (time-mk -1 0 0 0 0 0))))
      
(define (losthalls-timer-check kplace)
	(let ((timerlist (kplace-get-objects-of-type kplace t_losthalls_timer)))
		(if (equal? (length timerlist) 0)
			(let ((newtimer (losthalls-mk-timer)))
				(kern-obj-put-at newtimer (list kplace 0 0))
				(losthalls-timer-set! newtimer (kern-get-time))
				#t
				)
			(let* ((timer (car timerlist))
					(respawn (losthalls-respawn-time? (losthalls-timer-time timer))))
				(losthalls-timer-set! timer (kern-get-time))
				respawn
				))
		))
          
(define (losthalls-do-prmap-content kplace roomdata)
	(if (losthalls-timer-check kplace)
		(losthalls-room-init-contents kplace roomdata)))
	
	
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; handles
  
(define (losthalls-link-factory x y z map dir)
		(list 'm_losthalls_cpassage2 nil)
		)  

(define (losthalls-link-factory-ruin x y z map dir)
		(list 'm_losthalls_rhall nil)
		)  
  
(define (losthalls-init-cohesion mapdata ruindata)
	(if (list-ref mapdata 10)
		(begin
			(kern-log-msg "begin cohesion check")
			(prmap-ensure-cohesion mapdata -3 3 1 7 0 losthalls-link-factory)
			(prmap-ensure-cohesion ruindata 0 5 0 5 1 losthalls-link-factory-ruin)
			(kern-log-msg "end cohesion check")
			(mutable-list-set mapdata 10 #f)
		)))
  
(define (losthalls-room-custom-hardlinks rxloc ryloc rzloc hardlinks)
	(vector-merge
		(prmap-room-hardlinkentry-get rxloc ryloc rzloc hardlinks)
		(vector
			(if (> ryloc 7) (list nil 'm_losthalls_cwall) nil)
			(if (< rxloc -3) (list nil 'm_losthalls_cwall) nil)
			(if (> rxloc 3) (list nil 'm_losthalls_cwall) nil)
			(if (< ryloc 1) (list nil 'm_losthalls_cwall) nil)
		)
	))
	
(define (losthalls-ruin-custom-hardlinks rxloc ryloc rzloc hardlinks)
	(vector-merge
		(prmap-room-hardlinkentry-get rxloc ryloc rzloc hardlinks)
		(vector
			(if (> ryloc 4) (list nil 'm_losthalls_rwall) nil)
			(if (< rxloc 1) (list nil 'm_losthalls_rwall) nil)
			(if (> rxloc 4) (list nil 'm_losthalls_rwall) nil)
			(if (< ryloc 1) (list nil 'm_losthalls_rwall) nil)
		)
	))

(define (losthalls-room-handle-deeps kplace kplayer)
	(let* (
			(roomdata (get-roomdata kplace))
			(smapdata (prmap-get-mapdata (eval 'p_lost_halls_r1)))
			(mapdata 
				(if (zero? (prmap-roomdata-z roomdata))
					smapdata
					(prmap-get-mapdata (eval 'p_lost_halls_r2)))
			)
		)
		(prmap-room-freeze-current smapdata)
		(prmap-room-init-neighbors kplace roomdata)
		(prmap-room-init-links kplace roomdata mapdata)
		(prmap-room-cleanout kplace)
		(prmap-room-thaw kplace smapdata)		
		(prmap-room-blit-map kplace roomdata mapdata)
		(losthalls-do-prmap-content kplace roomdata)
	))
	
(define (losthalls-room-handle-staird kplace kplayer)
	(let* (
			(roomdata (get-roomdata kplace))
			(mapdata (prmap-get-mapdata (eval 'p_lost_halls_r1)))
		)
		(prmap-room-freeze-current mapdata)
		(prmap-room-init-neighbors kplace roomdata)
		(prmap-room-init-links kplace roomdata mapdata)		
		(prmap-room-blit-map-edges kplace roomdata mapdata)
		;;(losthalls-room-init-contents kplace roomdata)
	))
	
(define (losthalls-room-handle-stairu kplace kplayer)
	(let* (
			(roomdata (get-roomdata kplace))
			(smapdata (prmap-get-mapdata (eval 'p_lost_halls_r1)))
			(mapdata (prmap-get-mapdata (eval 'p_lost_halls_r2)))
		)
		(prmap-room-freeze-current smapdata)
		(prmap-room-init-neighbors kplace roomdata)
		(prmap-room-init-links kplace roomdata mapdata)		
		(prmap-room-blit-map-edges kplace roomdata mapdata)
		(kern-place-set-neighbor south kplace nil)
		;;(losthalls-room-init-contents kplace roomdata)
	))
	
(define (losthalls-room-handle-croom kplace kplayer)
	(let* (
			(roomdata (get-roomdata kplace))
			(mapdata (prmap-get-mapdata (eval 'p_lost_halls_r1)))
		)
		(prmap-room-freeze-current mapdata)
		(prmap-room-init-neighbors kplace roomdata)
		(prmap-room-init-links kplace roomdata mapdata)		
		(prmap-room-blit-map-edges kplace roomdata mapdata)
		;;(losthalls-room-init-contents kplace roomdata)
	))
	
(define (losthalls-room-handle-rroom kplace kplayer)
	(let* (
			(roomdata (get-roomdata kplace))
			(smapdata (prmap-get-mapdata (eval 'p_lost_halls_r1)))
			(mapdata (prmap-get-mapdata (eval 'p_lost_halls_r2)))
		)
		(prmap-room-freeze-current smapdata)
		(prmap-room-init-neighbors kplace roomdata)
		(prmap-room-init-links kplace roomdata mapdata)		
		(prmap-room-blit-map-edges kplace roomdata mapdata)
		;;(losthalls-room-init-contents kplace roomdata)
	))

(define (losthalls-room-handle-start kplace kplayer)
	(let* (
		(roomdata (get-roomdata (eval 'p_lost_halls_r1)))
		(mapdata (prmap-get-mapdata (eval 'p_lost_halls_r1)))
		(ruindata (prmap-get-mapdata (eval 'p_lost_halls_r2)))
		)
		(losthalls-init-cohesion mapdata ruindata)
		(prmap-room-freeze-current mapdata)
		(prmap-roomdata-setxyz roomdata 0 0 0)
		(kern-place-set-neighbor north kplace (eval 'p_lost_halls_r1))
	))	
	

	
	
	
